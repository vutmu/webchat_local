<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WasmohWeb</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>


</head>
<body >
<script>

    function pretty_print(json)
    {
        let author=json['author'].toString()
        let body=json['body'].toString()
        return author+' написал: '+body
    }
    //Изменить параметры пагинации

    function do_smth()
    {
        var last_id = 0;
        if ($("p").is(".messages p")){
            last_id = $('.messages > p:last-child').attr('id');
        }
        else {
            console.log("новый last_id не найден")
        }


        $.get("/get_mess",{ last_id: last_id}, function(response)
        {
            var messages = $.parseJSON(response);
            var posts=messages['posts'];
            //console.log(posts)
            $.each(posts, function(index, value)
            {
                let p=$('<p></p>').attr("id",value['id']).html(pretty_print(value))
                $('.messages').append(p);
            });
        });
    }

    function send_mess(){

        let json_data = {name: $('#your_name').text(), text: $('#your_message').val()};
        $.post("/send", json_data);
    }
</script>
Привет,<p id="your_name">{{user}}</p>
<!--<p><label for="your_name">Ваше имя:</label>-->
<!--    <input id="your_name" type="text"></p>-->
<p><label for="your_message">Введите текст:</label></p>
<p><textarea id="your_message" cols="200" maxlength="1000" rows="5"> </textarea></p>
<input type="button" value="Отправить" onclick="send_mess();">

<div class="messages" style="width: 400px; height: 600px; overflow: auto;"></div>
<script>
    setInterval(do_smth,5000)
</script>
</body>
</html>